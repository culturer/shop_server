<!DOCTYPE html>
<html>
<head>
    <title>商品添加</title>
    <link rel="stylesheet" type="text/css" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../static/css/summernote.css">
    <link rel="stylesheet" type="text/css" href="../static/css/font-awesome.min.css">
    <link href="../static/css/ssi-uploader.css" rel="stylesheet" />
    <style>
        .note-editable {
            border:1px solid #f5f5f5;
            border-top:none
        }
    </style>
</head>


<body style="margin:0;box-sizing:border-box">
    <ol class="breadcrumb" style="position:fixed;top:0;width:100vw">
        <li><a href="product_list.html">商品列表</a></li>

        <li class="active">商品添加</li>
    </ol>

    <div class="container" style="max-width:750px;margin-top:40px">
        <input type="hidden" id="attr_id" />
        <div class="form-group">
            <input type="text" id="attr_name" required class="form-control" placeholder="商品名称" />
        </div>
        <div class="form-group">
            <textarea id="attr_msg" class="form-control" placeholder="子描述"></textarea>
        </div>
        <div class="form-group">
            <div class="row">
                <div class="col-sm-6"><input type="text" required id="attr_price" class="form-control" placeholder="售价" /></div>
                <div class="col-sm-6"><input type="text" id="attr_standardPrice" class="form-control" placeholder="成本价" /></div>
            </div>


        </div>
        <div class="form-group">
            <div class="row">
                <div class="col-sm-6"><input id="attr_count" required type="number" class="form-control" placeholder="库存" /></div>
                <div class="col-sm-6">
                    <select required id="attr_productTypeId"class="form-control" >
                        <option value="1">商品分类</option>
                    </select>
                </div>
            </div>


        </div>
        <div class="form-group" id="on_upload">
            <input id="file_names" name="file_names" value="" type="hidden" />
            <input id="file_paths" name="file_paths" value="" type="hidden" />
            <input id="file_exts" name="file_exts" value="" type="hidden" />
            <input id="file_sizes" name="file_sizes" value="" type="hidden" />
            <input name="Filedata" type="file" multiple="multiple" id="ssi-upload" />
        </div>

        <p>详情描述</p>
        <div id="attr_desc" class="form-control">
        </div>

    </div>
    <div class="form-group text-center" style="position:fixed;bottom:0;width:100vw">
        <button class="btn btn-info" onclick="submitProduct()">保存</button>
    </div>
    <script type="text/javascript" src="../static/js/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="../static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../static/js/summernote.min.js"></script>
    <script type="text/javascript" src="../static/js/summernote-zh-CN.js"></script>
    <script type="text/javascript" src="../static/js/summernote-zh-CN.js"></script>
    <script type="text/javascript" src="../static/js/ssi-uploader.js"></script>
    <script type="text/javascript" src="../static/js/center-loader.js"></script>
    <script type="text/javascript">
        $("#attr_desc").summernote({ lang: "zh-CN", height: 400});
        $('#ssi-upload').ssi_uploader({
            url: 'url',
            data: { Folder: "Upload\\Tmp" },
            locale: "ch",
            allowed: ['jpg', 'jpeg', 'png', 'bmp', 'gif'],
            dropZone: false
        });

        function submitProduct() {

            $('input[required]').each(function () {
                if ($(this).val().trim() == "") {

                    alert($(this).attr('placeholder'))
                    $(this).focus();
                    return
                }

            });
            $('body').loader("show", $('<i class="fa fa-2x fa-spinner fa-spin"></i>'))
            $.ajax({
                url: location.origin +"/products",
                data: {
                    types: 1,
                    options: 1,
                    productTypeId: $("#attr_productTypeId").val(),
                    name: encodeURIComponent($("#attr_name").val()),
                    price: $("#attr_price").val(),                  
                    desc: encodeURIComponent($("#attr_desc").code()),
                    count: $("#attr_count").val(), 
                    standardPrice: $("#attr_standardPrice").val(),
                    msg: encodeURIComponent( $("#attr_msg").val()), 

                },
                type: "post",
                dataType: "json",
                success: function (e) {

                    if (e.status == "200") {
                        var e = confirm("添加成功是否重新加载")
                        if (e == true) {
                            location.reload()
                        }
                    } else if (e.status == "400") {
                        alert(e.msg)
                    }
                },
                complete: function (e) {
                    $("body").loader("hide")
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert("状态：" + textStatus + "；出错提示：" + errorThrown);
                },
            });
        }
    </script>
</body>
</html>